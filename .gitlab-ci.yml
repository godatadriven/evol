image: python:3.6

stages:
  - docs
  - test

before_script:
  - pip install --upgrade pip
  - pip install -e .[dev]

.test:
  script:
    - flake8
    - python setup.py test
    - python examples/simple_nonlinear.py
    - python examples/number_of_parents.py --n-parents=2 --workers=1
    - python examples/number_of_parents.py --n-parents=3 --workers=1
    - python examples/number_of_parents.py --n-parents=4 --workers=1
    - python examples/number_of_parents.py --n-parents=2 --workers=2
    - python examples/number_of_parents.py --n-parents=3 --workers=2
    - python examples/number_of_parents.py --n-parents=4 --workers=2
    - python examples/very_basic_tsp.py
    - python examples/simple_logging.py
    - python examples/rock_paper_scissors.py
  stage: test

py36:
  extends: .test
  image: python:3.6

py37:
  extends: .test
  image: python:3.7

.docs:
  image: python:3.6
  stage: docs
  script:
  - pip install -e .[docs]
  - pip freeze
  - sphinx-apidoc -f -o doc/api evol
  - sphinx-build doc public
  artifacts:
    paths:
    - public

pages:
  extends: .docs
  only:
    - master
